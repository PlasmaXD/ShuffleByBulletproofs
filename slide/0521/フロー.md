シーケンス図で、VLDPPipeline の主要フロー
```mermaid
sequenceDiagram
    autonumber
    participant S as サーバー
    participant CU as クライアント i<br>（Untrusted）
    participant CT as クライアント i<br>（Trusted Enclave）
    participant Sh as シャッフラー

    %% ステップ0: 乱数の相互生成
    S->>CU: 0.1 乱数シード要求
    CU->>S: 0.2 部分乱数応答
    Note over S,CU: 共通乱数シード生成

    %% ステップ1→2: データの署名取得
    CU->>CT: 1. 元データ要求
    CT->>CU: 2. 署名付きデータ

    %% ステップ3: LDP＋NIZK生成
    CU->>CU: 3. LDP処理＆NIZK証明生成
    Note over CU: 署名付きデータにノイズ付与＋証明作成

    %% ステップ4: シャッフラーへ送信
    CU->>Sh: 4. DP出力＋NIZK証明

    %% ステップ4（継続）: シャッフル
    Sh->>Sh: 4.x n 件をランダム並べ替え
    Sh->>S: 4.y シャッフル済みDP出力＋NIZK証明

    %% ステップ5→6: サーバーで検証・集計
    S->>S: 5. 各 NIZK 証明検証
    S->>S: 6. DP 出力抽出・集計
    S->>S: 7. 結果公開
```

---

### 各ステップ対応

1. **ステップ0（乱数相互生成）**
   サーバーとクライアントがそれぞれ部分的な乱数をやり取りし、共通の乱数シードを安全に確定。

2. **ステップ1→2（署名付きデータ取得）**
   Trusted Enclave が元データを読み取り、秘密鍵で署名。アン・トラストド環境はその署名付きデータのみ受領。

3. **ステップ3（LDP＋NIZK証明生成）**
   アン・トラストド環境でローカル差分プライバシー処理（ノイズ付与）を行い、非対話型ゼロ知識証明を同時生成。

4. **ステップ4（シャッフル）**
   各クライアントから送られた DP 出力と証明をシャッフラーがランダムに並べ替え、順序の匿名化を強化。

5. **ステップ5（証明検証）**
   サーバー側で NIZK 証明を検証し、不正なものは排除。

6. **ステップ6→7（集計・公開）**
   検証済みの DP 出力を集計し、最終的な統計結果を公開。

